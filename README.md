Тестовое задание Gipsy Land

## Требования:

Приложение должно поддерживать раздачу HTML страниц на несколько доменов;

Каждая страница должна быть доступна по уникальному URL, соответствующему домену;

Контент страниц должен храниться централизованно.

Рекомендуемый технологический стек:

- Node.js
- Express
- Next.js


## Обзор файлов проекта

`./middleware.ts` - осуществляет маршрутизацию. Перенаправляет запросы от пользователя таким образом:
- без поддомена -> /home/page.tsx
- поддомен `express` -> перенаправляет запрос на экспресс сервер по адресу в `.env` EXPRESS_URL
- другие поддомены -> /app/[subdomain]/[[...slug]]/page.tsx

`./prisma/shema.prisma` - схема базы данных. Содержит 1 таблицу Article. Чтобы создать новый поддомен надо создать соотвествующую статью в БД. 

Папка `./express/`  содержит в себе простой express сервер, который выдает только 1 страницу. Можно считать это отдельным проектом. 

`./app/[subdomain]/[[...slug]]/schemas.ts` - содержит в себе zod схему getArticle, в дальнейшем мы можем использовать её для создания и валидации API.

`./app/[subdomain]/[[...slug]]/methods.ts` - содержит метод getArticle который возвращает статью из БД.


## Запуск с помощью Docker 

Docker engine должен быть запущен
```sh 
docker compose -f "compose.yaml" up -d --build 
```
Откройте `http://localhost:3000` чтобы убедиться что работает главная страница /app/home/

Откройте `http://express.localhost:3000` чтобы убедитья что работает express сервер и маршрутизация. 

Поключитесь к БД и создайте новую статью по адресу `http://test.localhost:3000/`
```sql
INSERT INTO "Article"("content","subdomain","title","slug") VALUES('Hello world','test','Hello world','/');
```
Поле `slug` это адрес страницы после домена.

## Обзор Docker архитектуры

В докере 3 контейнера:
- next  - next.js сервер
- express - express сервер
- postgres - база данных

`middleware.ts` обращается к express контейнеру по адресу `http://express:3001`.

Prisma обращается к БД по адресу `postgres:5432`.

У `next` порт 3000 открыт наружу, у остальных контейнеров порты открыты только для хоста в целях безопасности. 

Подключиться к БД для редактирования статей можно по адресу `postgresql://postgres:qwerty@localhost:5432/mydb?schema=public` с помощью DBeaver или любым другим способом.

Пароли можно спрятать в docker secrets для простоты я его делать не стал.

## Запуск без Docker

Создайте .env файл по примеру .env.example

На вашей машине должен быть запущен postgress сервер и его credentials лежать в .env

Запуск next сервера
```sh
npm i
npm run dev
```
Запуск express сервера
```sh
cd express
npm i
npx ts-node server.ts
```